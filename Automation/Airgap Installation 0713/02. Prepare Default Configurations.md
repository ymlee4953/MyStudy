# **02. Prepare Default Configurations**

## Initialize

1. Create Directoy for new Cluster

    1.1. Create Directory

    - At the bastion/ansible Server

          mkdir -p $HOME/ansible-playbooks
          mkdir -p $HOME/configurations
          mkdir -p $HOME/files


2. Create ansible playbook to change server password

    - prepare python-passlib

          yum install -y python-passlib

    - Create ansible playbooks for change password 

          mkdir -p $HOME/ansible-playbooks/initialize

          cat <<EOF> $HOME/ansible-playbooks/initialize/change-password.yml
          # change-password.yml
          ---
          - hosts: etcd:master:worker:lb*:router:infra:shared:glusterfs
            become: yes
            tasks:
              - name: Change user password
                user:
                  name: root
                  update_password: always
                  password: "{{ newpassword|password_hash('sha512') }}"
          EOF

          cat $HOME/ansible-playbooks/initialize/change-password.yml

---
## VM setup

3. Copy Configuration file to each server

    3.1 Apply Nexus Configuration
    
    - Create ansible playbooks

          cat <<EOF> $HOME/ansible-playbooks/initialize/set_yum_repo.yml
          # set_yum_repo.yml
          ---
          - hosts: master:worker:lb*:router:infra:glusterfs
            become: true
            tasks:
              - name: copy airgap YUM Repo File
                copy:
                  src: $HOME/configurations/etc/yum.repos.d/nexus.repo
                  dest: /etc/yum.repos.d/nexus.repo
          EOF

          cat $HOME/ansible-playbooks/initialize/set_yum_repo.yml
